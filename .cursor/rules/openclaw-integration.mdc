---
description: OpenClaw AI agent integration patterns
globs: frontend/lib/services/**/*.ts,openclaw/**/*
alwaysApply: false
---

# OpenClaw Integration

OpenClaw is the AI agent runtime. Called via CLI, not as a library.

## How It Works

1. `runOpenClaw(message, sessionId)` spawns `openclaw agent --local` as a child process
2. Session ID provides persistent memory across calls â€” use `agentId` as session ID
3. OpenClaw reads `openclaw/workspace/AGENTS.md` for persona and `COMPANY_CONTEXT.md` for company context
4. Documents in `openclaw/workspace/documents/` are readable by the agent via its `read` tool
5. Falls back to Anthropic SDK (`claude-sonnet-4-6`) if OpenClaw CLI is unavailable

## Adding Agent Capabilities

- **New skills**: Create `openclaw/workspace/skills/{skill-name}/SKILL.md`
- **Persona changes**: Edit `openclaw/workspace/AGENTS.md`
- **Per-company context**: Written dynamically to `openclaw/workspace/COMPANY_CONTEXT.md` during onboarding

## Agent Identity System

Each company gets an auto-generated identity (codename, specialty, tone, tagline) stored in the `agents` table. Generated by Claude during onboarding, injected into COMPANY_CONTEXT.md so OpenClaw adopts the persona.

## Spawning Pattern (Node.js)

```typescript
import { spawn } from "child_process";
const proc = spawn("openclaw", ["agent", "--local", "--message", msg, "--session-id", id]);
// collect stdout/stderr via Buffer chunks, resolve on "close" event
```
